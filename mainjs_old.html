<script>
let nmin = 0,
    nsec = 0,
    nhour = 0,
    isPaused = false,
    refreshIntervalId = "",
    dataChips = [],
    targetingChips = [],
    countryTimeout = null,
    settings = !localStorage.settings ?
    localStorage.setItem("settings", JSON.stringify({
        "dark_mode": false,
        "bls_mode": false,
        "change_position": false,
        "show_temper": false,
        "show_MV": false,
        "show_NI": false,
        "case_reminder": false
        
    })) :
    console.log('Settings set');

let data={countrySelectOptions:[{name:"Afghanistan"},{name:"Ã…land Islands"},{name:"Albania"},{name:"Algeria"},{name:"American Samoa"},{name:"Andorra"},{name:"Angola"},{name:"Anguilla"},{name:"Antarctica"},{name:"Antigua and Barbuda"},{name:"Argentina"},{name:"Armenia"},{name:"Aruba"},{name:"Australia"},{name:"Austria"},{name:"Azerbaijan"},{name:"Bahamas"},{name:"Bahrain"},{name:"Bangladesh"},{name:"Barbados"},{name:"Belarus"},{name:"Belgium"},{name:"Belize"},{name:"Benin"},{name:"Bermuda"},{name:"Bhutan"},{name:"Bolivia"},{name:"Bosnia and Herzegovina"},{name:"Botswana"},{name:"Bouvet Island"},{name:"Brazil"},{name:"British Indian Ocean Territory"},{name:"Brunei Darussalam"},{name:"Bulgaria"},{name:"Burkina Faso"},{name:"Burundi"},{name:"Cambodia"},{name:"Cameroon"},{name:"Canada"},{name:"Cape Verde"},{name:"Cayman Islands"},{name:"Central African Republic"},{name:"Chad"},{name:"Chile"},{name:"China"},{name:"Christmas Island"},{name:"Cocos (Keeling) Islands"},{name:"Colombia"},{name:"Comoros"},{name:"Congo"},{name:"Congo"},{name:"The Democratic Republic of The Cook Islands"},{name:"Costa Rica"},{name:"Cote D'ivoire"},{name:"Croatia"},{name:"Cuba"},{name:"Cyprus"},{name:"Czech Republic"},{name:"Denmark"},{name:"Djibouti"},{name:"Dominica"},{name:"Dominican Republic"},{name:"Ecuador"},{name:"Egypt"},{name:"El Salvador"},{name:"Equatorial Guinea"},{name:"Eritrea"},{name:"Estonia"},{name:"Ethiopia"},{name:"Falkland Islands (Malvinas)"},{name:"Faroe Islands"},{name:"Fiji"},{name:"Finland"},{name:"France"},{name:"French Guiana"},{name:"French Polynesia"},{name:"French Southern Territories"},{name:"Gabon"},{name:"Gambia"},{name:"Georgia"},{name:"Germany"},{name:"Ghana"},{name:"Gibraltar"},{name:"Greece"},{name:"Greenland"},{name:"Grenada"},{name:"Guadeloupe"},{name:"Guam"},{name:"Guatemala"},{name:"Guernsey"},{name:"Guinea"},{name:"Guinea-bissau"},{name:"Guyana"},{name:"Haiti"},{name:"Heard Island and Mcdonald Islands"},{name:"Holy See (Vatican City State)"},{name:"Honduras"},{name:"Hong Kong"},{name:"Hungary"},{name:"Iceland"},{name:"India"},{name:"Indonesia"},{name:"Iran"},{name:"Iraq"},{name:"Ireland"},{name:"Isle of Man"},{name:"Israel"},{name:"Italy"},{name:"Jamaica"},{name:"Japan"},{name:"Jersey"},{name:"Jordan"},{name:"Kazakhstan"},{name:"Kenya"},{name:"Kiribati"},{name:"Korea"},{name:"Democratic People's Republic of Korea"},{name:"Republic of Kuwait"},{name:"Kyrgyzstan"},{name:"Lao People's Democratic Republic"},{name:"Latvia"},{name:"Lebanon"},{name:"Lesotho"},{name:"Liberia"},{name:"Libyan Arab Jamahiriya"},{name:"Liechtenstein"},{name:"Lithuania"},{name:"Luxembourg"},{name:"Macao"},{name:"Macedonia"},{name:"The Former Yugoslav Republic of Madagascar"},{name:"Malawi"},{name:"Malaysia"},{name:"Maldives"},{name:"Mali"},{name:"Malta"},{name:"Marshall Islands"},{name:"Martinique"},{name:"Mauritania"},{name:"Mauritius"},{name:"Mayotte"},{name:"Mexico"},{name:"Federated States of Micronesia"},{name:"Moldova"},{name:"Monaco"},{name:"Mongolia"},{name:"Montenegro"},{name:"Montserrat"},{name:"Morocco"},{name:"Mozambique"},{name:"Myanmar"},{name:"Namibia"},{name:"Nauru"},{name:"Nepal"},{name:"Netherlands"},{name:"Netherlands Antilles"},{name:"New Caledonia"},{name:"New Zealand"},{name:"Nicaragua"},{name:"Niger"},{name:"Nigeria"},{name:"Niue"},{name:"Norfolk Island"},{name:"Northern Mariana Islands"},{name:"Norway"},{name:"Oman"},{name:"Pakistan"},{name:"Palau"},{name:"Palestinian Territory Occupied"},{name:"Panama"},{name:"Papua New Guinea"},{name:"Paraguay"},{name:"Peru"},{name:"Philippines"},{name:"Pitcairn"},{name:"Poland"},{name:"Portugal"},{name:"Puerto Rico"},{name:"Qatar"},{name:"Reunion"},{name:"Romania"},{name:"Russia"},{name:"Rwanda"},{name:"Saint Helena"},{name:"Saint Kitts and Nevis"},{name:"Saint Lucia"},{name:"Saint Pierre and Miquelon"},{name:"Saint Vincent and The Grenadines"},{name:"Samoa"},{name:"San Marino"},{name:"Sao Tome and Principe"},{name:"Saudi Arabia"},{name:"Senegal"},{name:"Serbia"},{name:"Seychelles"},{name:"Sierra Leone"},{name:"Singapore"},{name:"Slovakia"},{name:"Slovenia"},{name:"Solomon Islands"},{name:"Somalia"},{name:"South Africa"},{name:"South Georgia and The South Sandwich Islands"},{name:"Spain"},{name:"Sri Lanka"},{name:"Sudan"},{name:"Suriname"},{name:"Svalbard and Jan Mayen"},{name:"Swaziland"},{name:"Sweden"},{name:"Switzerland"},{name:"Syrian Arab Republic"},{name:"Taiwan"},{name:"China"},{name:"Tajikistan"},{name:"Tanzania"},{name:"Thailand"},{name:"Timor-leste"},{name:"Togo"},{name:"Tokelau"},{name:"Tonga"},{name:"Trinidad and Tobago"},{name:"Tunisia"},{name:"Turkey"},{name:"Turkmenistan"},{name:"Turks and Caicos Islands"},{name:"Tuvalu"},{name:"Uganda"},{name:"Ukraine"},{name:"United Arab Emirates"},{name:"United Kingdom"},{name:"United States"},{name:"United States Minor Outlying Islands"},{name:"Uruguay"},{name:"Uzbekistan"},{name:"Vanuatu"},{name:"Venezuela"},{name:"Viet Nam"},{name:"Virgin Islands British"},{name:"Virgin Islands U.S."},{name:"Wallis and Futuna"},{name:"Western Sahara"},{name:"Yemen"},{name:"Zambia"},{name:"Zimbabwe"}],languageSelectOptions:[{name:"Afrikaans (af)",langCode:"af"},{name:"Albanian (sq)",langCode:"sq"},{name:"Amharic (am)",langCode:"am"},{name:"Arabic (ar)",langCode:"ar"},{name:"Arabic (Egypt) (ar-EG)",langCode:"ar-EG"},{name:"Armenian (hy)",langCode:"hy"},{name:"Azerbaijani (az)",langCode:"az"},{name:"Basque (eu)",langCode:"eu"},{name:"Belarusian (be)",langCode:"be"},{name:"Bengali (bn)",langCode:"bn"},{name:"Bosnian (bs)",langCode:"bs"},{name:"Bulgarian (bg)",langCode:"bg"},{name:"Burmese (Myanmar) (my)",langCode:"my"},{name:"Catalan (ca)",langCode:"ca"},{name:"Chinese (Hong Kong) (zh-HK)",langCode:"zh-HK"},{name:"Chinese (Malay) (zh-MS)",langCode:"zh-MS"},{name:"Chinese (Simplified) (zh-Hans)",langCode:"zh-Hans"},{name:"Chinese (Singapore) (zh-SG)",langCode:"zh-SG"},{name:"Chinese (Traditional) (zh-Hant)",langCode:"zh-Hant"},{name:"Croatian (hr)",langCode:"hr"},{name:"Czech (cs)",langCode:"cs"},{name:"Danish (da)",langCode:"da"},{name:"Dutch (nl)",langCode:"nl"},{name:"Dutch (Belgium) (nl-BL)",langCode:"nl-BL"},{name:"English (en)",langCode:"en"},{name:"English (Australia) (en-AU)",langCode:"en-AU"},{name:"English (Belgium) (en-BL)",langCode:"en-BL"},{name:"English (Canada) (en-CA)",langCode:"en-CA"},{name:"English (Hong Kong) (en-HK)",langCode:"en-HK"},{name:"English (India) (en-IN)",langCode:"en-IN"},{name:"English (Ireland) (en-IE)",langCode:"en-IE"},{name:"English (Malaysia) (en-MY)",langCode:"en-MY"},{name:"English (New Zealand) (en-NZ)",langCode:"en-NZ"},{name:"English (Singapore) (en-SG)",langCode:"en-SG"},{name:"English (South Africa) (en-ZA)",langCode:"en-ZA"},{name:"English (Switzerland) (en-CH)",langCode:"en-CH"},{name:"English (UK) (en-GB)",langCode:"en-GB"},{name:"Estonian (et)",langCode:"et"},{name:"Farsi (fa)",langCode:"fa"},{name:"Filipino (fil)",langCode:"fil"},{name:"Finnish (fi)",langCode:"fi"},{name:"French (fr)",langCode:"fr"},{name:"French (Belgium) (fr-BL)",langCode:"fr-BL"},{name:"French (Canada) (fr-CA)",langCode:"fr-CA"},{name:"French (Luxembourg) (fr-LU)",langCode:"fr-LU"},{name:"French (Switzerland) (fr-CH)",langCode:"fr-CH"},{name:"Galician (gl)",langCode:"gl"},{name:"Georgian (ka)",langCode:"ka"},{name:"German (de)",langCode:"de"},{name:"German (Austria) (de-AT)",langCode:"de-AT"},{name:"German (Belgium) (de-BL)",langCode:"de-BL"},{name:"German (Luxembourg) (de-LU)",langCode:"de-LU"},{name:"German (Switzerland) (de-CH)",langCode:"de-CH"},{name:"Greek (el)",langCode:"el"},{name:"Gujarati (gu)",langCode:"gu"},{name:"Hebrew (iw)",langCode:"iw"},{name:"Hindi (hi)",langCode:"hi"},{name:"Hungarian (hu)",langCode:"hu"},{name:"Icelandic (is)",langCode:"is"},{name:"Indonesian (id)",langCode:"id"},{name:"Irish (ga)",langCode:"ga"},{name:"Italian (it)",langCode:"it"},{name:"Italian (Switzerland) (it-CH)",langCode:"it-CH"},{name:"Japanese (ja)",langCode:"ja"},{name:"Kannada (kn)",langCode:"kn"},{name:"Kazakh (kk)",langCode:"kk"},{name:"Khmer (km)",langCode:"km"},{name:"Kinyarwanda (rw)",langCode:"rw"},{name:"Korean (ko)",langCode:"ko"},{name:"Kyrgyz (ky)",langCode:"ky"},{name:"Lao (lo)",langCode:"lo"},{name:"Latin (la)",langCode:"la"},{name:"Latvian (lv)",langCode:"lv"},{name:"Lithuanian (lt)",langCode:"lt"},{name:"Luganda (lg)",langCode:"lg"},{name:"Macedonian (mk)",langCode:"mk"},{name:"Malagasy (mg)",langCode:"mg"},{name:"Malay (ms)",langCode:"ms"},{name:"Malayalam (ml)",langCode:"ml"},{name:"Maltese (mt)",langCode:"mt"},{name:"Marathi (mr)",langCode:"mr"},{name:"Mauritian Creole (crp)",langCode:"crp"},{name:"Mongolian (mn)",langCode:"mn"},{name:"Nepali (ne)",langCode:"ne"},{name:"Norwegian (no)",langCode:"no"},{name:"Norwegian (DO NOT USE) (nb)",langCode:"nb"},{name:"Norwegian (Nynorsk) (nn)",langCode:"nn"},{name:"Oriya (or)",langCode:"or"},{name:"Polish (pl)",langCode:"pl"},{name:"Portuguese (pt)",langCode:"pt"},{name:"Portuguese (Brazil) (pt-BR)",langCode:"pt-BR"},{name:"Punjabi (pa)",langCode:"pa"},{name:"Rhaeto-Romance (rm)",langCode:"rm"},{name:"Romanian (ro)",langCode:"ro"},{name:"Russian (ru)",langCode:"ru"},{name:"Russian (Azerbaijan) (ru-AZ)",langCode:"ru-AZ"},{name:"Russian (Belarus) (ru-BY)",langCode:"ru-BY"},{name:"Russian (Kazakhstan) (ru-KZ)",langCode:"ru-KZ"},{name:"Russian (Ukraine) (ru-UA)",langCode:"ru-UA"},{name:"Serbian (sr)",langCode:"sr"},{name:"Sinhala (si)",langCode:"si"},{name:"Slovak (sk)",langCode:"sk"},{name:"Slovenian (sl)",langCode:"sl"},{name:"Spanish (es)",langCode:"es"},{name:"Spanish (Latin America) (es-419)",langCode:"es-419"},{name:"Swahili (sw)",langCode:"sw"},{name:"Swedish (sv)",langCode:"sv"},{name:"Tamil (ta)",langCode:"ta"},{name:"Telugu (te)",langCode:"te"},{name:"Thai (th)",langCode:"th"},{name:"Turkish (tr)",langCode:"tr"},{name:"Ukrainian (uk)",langCode:"uk"},{name:"Urdu (ur)",langCode:"ur"},{name:"Uzbek (uz)",langCode:"uz"},{name:"Vietnamese (vi)",langCode:"vi"},{name:"Welsh (cy)",langCode:"cy"},{name:"Yiddish (yi)",langCode:"yi"},{name:"Yoruba (yo)",langCode:"yo"},{name:"Zulu (zu)",langCode:"zu"}],SRCategories:[{name:"Review-SurveyStarted"},{name:"Review-NeedsInfo"},{name:"Review-Consult"},{name:"Review-Non-EN"},{name:"Review-HealthMedical"},{name:"Review-Policypoll"},{name:"Review-ReviewedMoreThanOnce"},{name:"Review-SurveysAskLab"},{name:"Review-IntRecurring"},{name:"Review-IntResponses"},{name:"Review-Targeting"},{name:"Review-NielsenDMA"},{name:"Review-RMK"},{name:"Review-Zip"},{name:"Review-Surveys360"},{name:"Review-Enterprise-Invoice"},{name:"Review-Enterprise-SharedBalance"},{name:"TRN"},{name:"SurveyDeleted"},{name:"Support-RefundCoupon"},{name:"Review-Split"},{name:"Overpaid"},{name:"Review-Language"},{name:"Review-R&CGeneral"},{name:"Review-SexStarted"},{name:"Review-Financial"},{name:"Review-HealthStarted"},{name:"Review-PoliticalStarted"},{name:"Review-TechStarted"},{name:"Review-AlcoholStarted"},{name:"Review-GamblingStarted"},{name:"Review-TradeUnion"},{name:"Review-OtherForbidden"},{name:"Review-MachineTranslation"},{name:"Review-IncorrectTargeting"},{name:"Review-AdultContent"},{name:"Review-Capitalization"},{name:"Review-CharacterLimit(ContentTruncated)"},{name:"Review-ElectionPolling"},{name:"Review-General:Clarity"},{name:"Review-General:DoNotAnswer"},{name:"Review-General:FalseInformation"},{name:"Review-General:GimmickySymbols"},{name:"Review-General:IncorrectQuestionFeature"},{name:"Review-General:AnswerDuplicate/Overlap"},{name:"Review-General:Pre-Screener"},{name:"Review-Health:Vivid"},{name:"Review-Health:OtherNon-Starter"},{name:"Review-Health:GOROnly"},{name:"Review-ImageUnclear"},{name:"Review-InappropriateLanguage"},{name:"Review-LanguageMismatch"},{name:"Review-QuestionShouldScreen"},{name:"Review-ModifyScreeningQuestion"},{name:"Review-MultipleQuestions"},{name:"Review-NeedsPermissionScreen"},{name:"Review-NOTA:AgeQuestions"},{name:"Review-NotaMissing"},{name:"Review-Offensive:Death"},{name:"Review-Offensive:GeneralLiking"},{name:"Review-Offensive:Guns"},{name:"Review-Offensive:Other"},{name:"Review-Offensive:Violence"},{name:"Review-Offensive:Wars"},{name:"Review-OpenEndedNumeric"},{name:"Review-OpenEndedSingleLetter"},{name:"Review-PartialPin(AnswerNotPinned)"},{name:"Review-PII"},{name:"Review-PipingPlaceholderFormat"},{name:"Review-PolicyPolling:NeedsOptOut"},{name:"Review-PolicyPolling:Phrasing"},{name:"Review-PushPolling:Influence"},{name:"Review-PushPolling:CallToAction"},{name:"Review-PushPolling:Ad"},{name:"Review-QuestionType:Multi Answer"},{name:"Review-QuestionType:SingleAnswer"},{name:"Review-RangesMismatch"},{name:"Review-SensitiveDemo(Age,Gender,Race)"},{name:"Review-SensitiveDemo(Religion,Immigration,Sex):GOR"},{name:"Review-SensitiveDemo(Religion,Immigration,Sex):NeedsOptOut"},{name:"Review-SensitiveSubjects:GOROnly"},{name:"Review-SensitiveSubjects:Non-Starter"},{name:"Review-Sensitive Subjects:NeedsOptOut"},{name:"Review-Spelling"},{name:"Review-Video:Length"},{name:"Review-Video:Multiple"},{name:"Review-Video:Private"}],supportCategories:[{name:"Support-NoActionNeeded"},{name:"Support-CreationWarm"},{name:"Support-RMK"},{name:"Support-Zip"},{name:"Support-AccountCreation"},{name:"Support-AddOwner"},{name:"Support-Adwords"},{name:"Support-BuyResponses"},{name:"Support-Creation"},{name:"Support-CustomSalesLeads"},{name:"Support-Contact"},{name:"Support-Flagged/Enterprise"},{name:"Support-Flagged/Internal"},{name:"Support-Flagged/Restarted"},{name:"Support-Flagged/Stopped"},{name:"Support-General"},{name:"Support-IncTest"},{name:"Support-IncToolBug"},{name:"Support-Methodology"},{name:"Support-NoQ"},{name:"Support-Pause/Stop"},{name:"Support-Payment/Billing"},{name:"Support-Policy"},{name:"Support-Pricing"},{name:"Support-ProductFeedback"},{name:"Support-RefundCoupon"},{name:"Support-Reporting/Analysis"},{name:"Support-Spam"},{name:"Support-Targeting"},{name:"Support-TrackingSubscriptions"},{name:"Support-UserFeedback(not GOR)"},{name:"Support-Websat"},{name:"Support-WhitelistSupport"},{name:"Support-Googler"},{name:"Support-Enterprise-Invoice"},{name:"Support-Enterprise-SharedBalance"},{name:"Support-AccountLinking"},{name:"Support-Surveys360Client"},{name:"Support-CustomSalesLeads"},{name:"Support-NeedsInfo"},{name:"Support-Consult"},{name:"Support-OpinionRewards"},{name:"Support-Chat"},{name:"Support-360Reseller"},{name:"Support-360"},{name:"Support-NewCustomer"},{name:"Support-Deleted"},{name:"Support-Inbound"},{name:"Support-Followup"},{name:"Support-Feedback"},{name:"Support-SameIssue"},{name:"Support-Deleted"},{name:"Review-ReviewedMoreThanOnce"},{name:"Support-NonEn"},{name:"Support-NonGCS"},{name:"TRN"},{name:"Overpaid"},{name:"Routed from Other Product"}],pubCategories:[{name:"Pub-AddOwner"},{name:"Pub-AdvancedTab"},{name:"Pub-HouseSurveys"},{name:"Pub-Frequency/Metering"},{name:"Pub-RHS"},{name:"Pub-AnchoredPrompt"},{name:"Pub-Triggerprompt/Async"},{name:"Pub-Callback"},{name:"Pub-CountryFiltering"},{name:"Pub-DomainFilter/refer"},{name:"Pub-PromptTitle"},{name:"Pub-PublisherExtendedAccessPeriod"},{name:"Pub-aaumessage"},{name:"Pub-Staging"},{name:"Pub-MobilePromptMessage"},{name:"Pub-ZipcodeFilter"},{name:"Pub-Selfie"},{name:"Pub-Strategic"},{name:"Pub-Policy"},{name:"Pub-ReportingDashboard"},{name:"Pub-AdSense/Payment"},{name:"Pub-Troubleshoot/Investigate"},{name:"Pub-Troubleshoot/InvestigateTriggerAsync"},{name:"Pub-Troubleshoot/InvestigateAnchored"},{name:"Pub-Troubleshoot/InvestigateCallback"},{name:"Pub-Troubleshoot/InvestigateCan'tSignUp"},{name:"Pub-Troubleshoot/InvestigateInventory"},{name:"Pub-AdvancedOthers"},{name:"Pub-FrequencyMeteringOthers"},{name:"Pub-TriggerPromptOthers"},{name:"Pub-CallbackOthers"},{name:"Pub-RHSOthers"},{name:"Pub-AnchoredPromptOthers"},{name:"Pub-dev"},{name:"Pub-dev>whitelist"},{name:"Pub-dev>approve"},{name:"Pub-SameIssue"},{name:"Pub-NeedsInfo"},{name:"Pub-Consult"},{name:"Pub-CallRequest"},{name:"Pub-CallDone"},{name:"Pub-Reach out"},{name:"Pub-Disabled"},{name:"Pub-SelfDisable"},{name:"Pub-General"},{name:"Pub-NewSelfie"},{name:"Pub-NewStrategic"},{name:"Pub-Feedback"},{name:"Pub-ProductFeedback"},{name:"Pub-UserFeedback"},{name:"TRN"},{name:"Support-Websat"}],partnershipCategories:[{name:"Partnership > DCLK - DBM > Approved"},{name:"Partnership > DCLK - DBM > Rejected"},{name:"Partnership > DCLK - DBM - Auto Reject"},{name:"Partnership > DCLK - DCM > Approved"},{name:"Partnership > DCLK - DCM > Rejected"},{name:"Partnership > DCLK - DCM - Auto Reject"},{name:"Partnership > DCLK - DS > Approved"},{name:"Partnership > DCLK - DS > Rejected"},{name:"Partnership > DCLK - DS - Auto Reject"},{name:"Partnership > GA360 - DS > Approved"},{name:"Partnership > GA360 - DS > Rejected"},{name:"Partnership > GA360 - GTM > Approved"},{name:"Partnership > GA360 - GTM > Rejected"},{name:"Partnership > GA360 - Optimize > Approved"},{name:"Partnership > GA360 - Optimize > Rejected"},{name:"Partnership > Forum Access Request > Approved"},{name:"Partnership > Forum Access Request > Rejected"},{name:"Partnership > GACP - Support"},{name:"Partnership > GACP - Escalate"},{name:"Partnership > DCLCK - Creative > Approved"},{name:"Partnership > DCLCK - Creative > Rejected"},{name:"Partnership > DCLCK - Creative - Auto Reject"},{name:"Partnership > DCLCK - Surveys > Approved"},{name:"Partnership > DCLCK - Surveys > Rejected"},{name:"Partnership-Consult"},{name:"TRN"}],studyChecker:{GTGLabel:[{label:"Refers to Sex",cr:"Your survey includes content with reference to sex."},{label:"Weight Loss Programs",cr:"Your survey includes content about weight loss programs."},{label:"Allowed Birth Control",cr:"Your survey includes content about allowed birth control."},{label:"Political Issues",cr:"Your survey includes content about political issues."},{label:"Political Candidates",cr:"Your survey includes content about political candidates."},{label:"Video Games",cr:"Your survey includes content about video games."},{label:"Alcohol",cr:"Your survey includes content about alcohol."},{label:"Gambling",cr:"Your survey includes content about gambling."}],NGTGLabel:[{label:"Adult Activities",cr:"Your survey includes content about adult activities."},{label:"Sexual Behavior",cr:"Your survey includes content about sexual behavior."},{label:"Drugs",cr:"Your survey includes content about drugs."},{cr:"Your survey includes content about guns.",label:"Guns"},{cr:'Your survey contains a spelling or grammatical error. Please correct it by editing the answer option "" into "".',label:"Spelling and Grammar"},{cr:"Your survey has answer options in a different language than the question.",label:"Wrong Language"},{cr:'Questions and answers should be grammatically clear, contextually relevant and directly associate with your survey content. Please edit the answer option "" to make it compliant.',label:"Garbage Text"},{cr:'The question doesn\'t seem to match with the answer options. Please edit or change the answer option/s "".',label:"Irrelevant"},{cr:'Your survey already includes a "None of the Above" option by default.',label:"None of the Above Answer"},{cr:"Your survey includes content about financial status.",label:"Financial Status"},{cr:"Your survey includes content about getting rich.",label:"Get Rich"},{cr:"Your survey includes content about loans or lending services.",label:"Loans"},{cr:"Your survey includes content about hospitals or health care facilities.",label:"Hospitals"},{cr:"Your survey includes content about weight loss pills.",label:"Weight Loss Pills"},{cr:"Your survey includes content about OTC drugs",label:"OTC Drugs"},{cr:"Your survey includes content about non-OTC drugs.",label:"Non-OTC Drugs"},{cr:"Your survey includes content about health conditions.",label:"Health Conditions"},{cr:"Your survey includes content about cosmetic procedures.",label:"Cosmetic Procedures"},{cr:"Your survey includes content about sexual health.",label:"Sexual Health"},{cr:"Your survey includes content about birth control products or methods.",label:"Disallowed Birth Control"},{cr:"Your survey includes content about medical treatments.",label:"Medical Treatments"},{cr:"Your survey contains inappropriate language.",label:"Inappropriate Language"},{cr:"Your survey includes content about harassment.",label:"Harassment"},{cr:"Your survey includes content about political issues.",label:"Political Issues"},{cr:"Your survey includes content about political candidates.",label:"Political Candidates"},{cr:"Your survey includes content about political affiliation.",label:"Political Affiliation"},{cr:"Your survey includes content about age.",label:"Age"},{cr:"Your survey includes content about gender",label:"Gender"},{cr:"Your survey includes content about sexual orientation.",label:"Sexual Orientation"},{cr:"Your survey includes content about race or ethnicity.",label:"Race Ethnicity"},{cr:"Your survey includes content about religion.",label:"Religion"},{cr:"Your survey includes content about immigration or immigrants.",label:"Immigration"},{cr:"Your survey includes content about death.",label:"Death"},{cr:"Your survey includes content about criminal record.",label:"Past Criminal Record"},{cr:"Your survey includes content about personally identifiable information.",label:"PII"},{cr:"Your survey includes content about alcohol.",label:"Alcohol"},{cr:"Your survey includes content about gambling.",label:"Gambling"},{cr:"Your survey includes content about push polling or promotion.",label:"Push Polling"},{cr:"Your survey includes content about trade union.",label:"Trade Union"},{cr:"Your survey includes content about _____.",label:"Other Forbidden (any other reason that is not captured by other policies)"}]}};
  
const assignSurvey = document.querySelector('#assignSurvey'),
      unassignSurvey = document.querySelector('#unassignSurvey'),
      needsInfoBtn = document.querySelector('#needsInfoBtn'),
      consultBtn = document.querySelector('#consultBtn'),
      // trackBtn = document.querySelector('#trackBtn'),
      caseID = document.querySelector('#caseID'),
      // card1 = document.querySelector('#card-1'),
      // card2 = document.querySelector('#card-2'),
      queueSelect = document.querySelector('#queue-select'),
      compliantBtn = document.querySelector('#compliant-btn'),
      noncompliantBtn =  document.querySelector('#noncompliant-btn'),
      closeBtn = document.querySelector('#close-btn'),
      // enableActions = document.querySelector('#enable_actions'),
      // closeCase = document.querySelector('#closeCase'),
      // countryInput = document.querySelector('#countryInput'),
      // languageInput = document.querySelector('#languageInput'),
      // settingsDropdown = document.querySelector('#settings-dropdown'),
      // blsModeSwitch = document.querySelector('#blsModeSwitch'),
      // darkModeSwitch = document.querySelector('#darkModeSwitch'),
      // cardNav = document.querySelector('#card-nav'),
      // targetingCategories = document.querySelector('#targeting-categories'),
      // rmto = document.querySelector('#rmto'),
      // blsChecker = document.querySelector('#blsChecker'),
      // consultTable = document.querySelector('#consultTable'),
      // selectSurveyDecision = document.querySelector("#selectSurveyDecision"),
      // refreshInterval = '',
      // searchData = [],
      searchInput= document.querySelector("#searchInput"),
      searchWrapper= document.querySelector("#searchWrapper"),
      searchResultsList= document.querySelector("#searchResultsList");
      // changePosition = document.querySelector("#changePosition"),
      // tableTitle = document.querySelector("#tableTitle"),
      // btnTableConsult = document.querySelector("#btnTableConsult"),
      // btnTableSubmitted = document.querySelector("#btnTableSubmitted"),
      // getConsultedCasesBtn = document.querySelector('#getConsultedCasesBtn'),
      // showTemper = document.querySelector('#showTemper'),
      // viewTemper = document.querySelector('#viewTemper'),
      // showMV = document.querySelector('#showMV'),
      // viewMV = document.querySelector('#viewMV'),
      // showNI = document.querySelector('#showNI'),
      // enableCaseAlarm = document.querySelector('#caseReminder');

////////////////////
// INITIALIZATION //
////////////////////

document.addEventListener('DOMContentLoaded', function() {
  var elems = document.querySelectorAll('select');
  var instances = M.FormSelect.init(elems, {});

  $('.chips').chips();
  addSearch("violations-chip");
});

// SweetAlert2 Mixin
const Toast = Swal.mixin({
  toast: true,
  position: 'top-end',
  showConfirmButton: false,
  timer: 3000,
  timerProgressBar: true,
  onOpen: (toast) => {
    toast.addEventListener('mouseenter', Swal.stopTimer)
    toast.addEventListener('mouseleave', Swal.resumeTimer)
  }
})

// Assign
assignSurvey.addEventListener('click', () => {
    !caseID.value ? caseID.classList.toggle('invalid') : doAssign();
});

//Survey Categories
searchInput.addEventListener("input", getResults);
$('#violations-chip').on('chip.delete', function(e, chip){
    dataChips.splice(dataChips.indexOf(chip.tag), 1);
    console.log(chip.tag);
});

countryInput.addEventListener('input', countryListener);
languageInput.addEventListener('input', languageListener);


// Survey Decisions
compliantBtn.addEventListener('click', () => {
    surveyDecision("compliant");
});

noncompliantBtn.addEventListener('click', () => {
    surveyDecision("noncompliant");
});

closeBtn.addEventListener('click', () => {
    surveyDecision("deleted");
});


/////////////////
////FUNCTIONS////
////////////////

function surveyDecision(decision){
    if  (!localStorage.assigned){
        console.log('There is assigned survey.');
    } else {
        let data = gatherData(),
        assigned = JSON.parse(localStorage.getItem('assigned'));

        assigned["decision"] = decision;
        localStorage.setItem("assigned", JSON.stringify(assigned));
        
        toggleDecisionBtn();
        // finish & back
        const enable_actions = document.querySelector('#enable_actions'),
              closeCase = document.querySelector('#closeCase');
              
        enable_actions.classList.toggle('hide');
        closeCase.classList.toggle('hide');
    }
}


function toggleDecisionBtn(){
   const compliantBtn = document.querySelector('#compliant-btn'),
    noncompliantBtn = document.querySelector('#noncompliant-btn'),
    closeBtn = document.querySelector('#close-btn'),
    enable_actions = document.querySelector('#enable_actions'),
    closeCase = document.querySelector('#closeCase'),
    blsChecker = document.querySelector('#blsChecker'),
    caseTemplateBtn = document.querySelector('#caseTemplateBtn'),
    blsMode = JSON.parse(localStorage.settings).bls_mode;

    console.log("BLS Mode: " + blsMode);
    
  // bls checker stop toggle
  //   let blsCheckerToggle = blsMode ? blsChecker.parentElement.classList.toggle('hide') : "Hiding bls checker...";
    
    // reset classes before toggling
    _doClearClass(compliantBtn);
    _doClearClass(noncompliantBtn);
    _doClearClass(closeBtn);
    _doClearClass(enable_actions);
    _doClearClass(closeCase);
    _doClearClass(caseTemplateBtn);
    
    
    // decisions
    compliantBtn.classList.toggle('hide');
    noncompliantBtn.classList.toggle('hide');
    closeBtn.classList.toggle('hide'); //deleted
    caseTemplateBtn.classList.toggle('hide');
    
    // finish & back
    enable_actions.classList.toggle('hide');
    closeCase.classList.toggle('hide');
}

function getSelectedQueue(){
  let selected = queueSelect.options[queueSelect.selectedIndex].value,
      categoryData = data.SRCategories;
  if (selected == "Survey Review") {
      categoryData = data.SRCategories;
  } else if(selected == "Support") {
      categoryData = data.supportCategories;
  } else if(selected == "Publisher") {
      categoryData = data.pubCategories;
  } else if(selected == "Partnership"){
      categoryData = data.partnershipCategories;
  } else {
      console.log('Invalid queue: ' + selected);
  }
  return categoryData;
}

function doAssign(){
    refreshInterval = setInterval(AHT, 1000),
    nmin = 0,
    nsec = 0,
    nhour = 0;

    let startDate = getFormattedDate();
    let caseIDInput = document.querySelector('#caseID');
    let caseID = Array.from(caseIDInput.value.split(","));
    let settings = localStorage.settings;
    let enableCaseAlarm = JSON.parse(settings).case_reminder;
    

    if (!localStorage.assigned){
      localStorage.setItem("assigned",JSON.stringify({
          "survey_ids": caseID,
          "start_time": startDate
        }));
      } else {
        console.log('There is assigned survey.');
    }
    
    console.log(JSON.parse(settings));
    
    Toast.fire({
      icon: 'success',
      title: 'Case has been assigned successfully!'
    });
    
    // toggleCards();
    disableButtons();
    enableButtons();
    initDecisionButtons();
    // if (enableCaseAlarm === true){
    //   setSwalByTime(5);
    //   // setSwalByTime(0.0001);
    // } else {
    //     console.log("Alarm is set to: " + enableCaseAlarm);
    // }
    
}

// added functions
function addResult(listElement, resultArray){
    // Reset result list every input trigger
    listElement.innerHTML = ``;
    
    // For each match add new li result
    resultArray.forEach((result) => {
        let searchResultItem = document.createElement('li');
        searchResultItem.classList.add('searchResultItem');
        searchResultItem.addEventListener('mousedown', autoCompleteInput);
        searchResultItem.innerHTML = `${result.name}`;
        searchResultItem.setAttribute("data-langcode", result.langCode);
        listElement.appendChild(searchResultItem);

    });
}

function languageListener(e){
    // filter from countries
    // return result to searchWrapper
    attachSearch(`#${e.target.id}`);
    console.log();

    let searchKeyword = e.target.value,
        languageInput = e.target,
        gridLanguage = languageInput.parentElement,
        searchWrapper = document.querySelector(`#${gridLanguage.id} > .inputWrapper`),
        resultList = searchWrapper.querySelector('.searchResultsList'),
        result = !searchKeyword ? [] : data.languageSelectOptions
            .filter(category => category
            .name
            .toLowerCase()
            .includes(searchKeyword));
    
    
    addResult(resultList, result);

    
}

function countryListener(e){
    // filter from countries
    // return result to searchWrapper
    attachSearch(`#${e.target.id}`);

    let searchKeyword = e.target.value,
        countryInput = e.target,
        gridCountry = countryInput.parentElement,
        searchWrapper = document.querySelector(`#${gridCountry.id} > .inputWrapper`),
        resultList = searchWrapper.querySelector('.searchResultsList'),
        result = !searchKeyword ? [] : data.countrySelectOptions
            .filter(category => category
            .name
            .toLowerCase()
            .includes(searchKeyword));
    
    
    
    addResult(resultList, result);
}

function attachSearch(parentID){
    
    let inputElement = document.querySelector(parentID),
        searchWrapperDiv = document.createElement('div');

    searchWrapperDiv.classList.add("inputWrapper");
    searchWrapperDiv.innerHTML = `
        <ul class="searchResultsList"></ul>
    `;
    inputElement.innerHTML = "";
    inputElement.parentElement.appendChild(searchWrapperDiv);
}


function autoCompleteInput (e){
    
    let inputElement = e.target
                    .parentElement
                    .parentElement
                    .parentElement
    .querySelector('.autocomplete');
    inputElement.value = e.target.textContent
    inputElement.setAttribute("data-langcode", e.target.dataset.langcode);
}


function addSearch(parent){
    let fuckinParent = document.querySelector(`#${parent}`),
        fuckinChips = document.querySelector('#violations-chip > input'),
        existingSearchWrapperDiv = document.querySelector('#searchWrapper'),
        searchWrapperDiv = document.createElement('div');

    fuckinChips.setAttribute("placeholder", "+Review-");
    fuckinChips.addEventListener('input', getResults);

    searchWrapperDiv.setAttribute("id", "searchWrapper");
    searchWrapperDiv.innerHTML = `
        <ul id="searchResultsList"></ul>
    `;
    if (existingSearchWrapperDiv){
      existingSearchWrapperDiv.remove();
      fuckinChips.value = "";
      fuckinParent.appendChild(searchWrapperDiv);
    } else {
      console.log('no existing wrapper, add new')
      fuckinParent.appendChild(searchWrapperDiv);
    }
    // fuckinParent.appendChild(searchWrapperDiv);
}


function getResults(e){
    let searchIndex = e.target.value,
        selectedQueue = getSelectedQueue(),
        // Filter category using searchIndex
        searchFilter = selectedQueue.filter(category => category.name.toLowerCase().includes(searchIndex)),
        // searchFilter = selectedQueue.filter(category => category.name .includes(searchIndex)),
        searchResultsList = document.querySelector("#searchResultsList");

        

    // Reset result list every input trigger
    searchResultsList.innerHTML = ``;
    
    // For each match add new li result
    searchFilter.forEach((result) => {
        let searchResultItem = document.createElement('li');
        searchResultItem.classList.add('searchCategoryItem');

        searchResultItem.innerHTML = `${result.name}`;
        searchResultsList.appendChild(searchResultItem);
        
    });

    // change this
    let showedItems = document.querySelectorAll('.searchCategoryItem') || [];


    searchResultListener(searchFilter, showedItems);

}


function searchResultListener(filteredArray, resultArray){
    if (filteredArray.length != 0){

        Array.from(resultArray).forEach((item) => {
            // console.log(item);
            item.addEventListener('mousedown', (e) => {
                const found = dataChips.some(el => el.tag === e.target.textContent);
                console.log(dataChips)
                console.log(e.target.textContent)
                if (!found){
                  dataChips.push({tag: e.target.textContent})
                  $('#violations-chip').chips({
                      data: dataChips
                  });
                  addSearch("violations-chip");
                  
                }
            });
        });
    }
}
///////////////
///UTILITIES///
///////////////
function getFormattedDate(dateGiven){
    let date = dateGiven == null || undefined  ? new Date(): new Date(dateGiven),
    formattedDate = (date.getMonth() + 1) + '/' + date.getDate() +  "/" + date.getFullYear();
    return formattedDate = formattedDate + " " + date.getHours() + ":" + date.getMinutes() + ":" + date.getSeconds();
}

function AHT() {
    document.querySelector('#aht').innerText = nhour + ":" + nmin + ":" + nsec;
    if (!isPaused) {
        nsec += 1;
        if (nsec == 60) {
            nsec = 00;
            nmin += 1;
        } else if (nmin == 60) {
            nmin = 00;
            nhour += 1;
        }
    }
}

function set_aht(min, sec){
    nmin = min;
    nsec = sec;
    nhour = 0;
}
  
function getFormattedAHT(date){
  
  
  let d = date !== "" && date != null ? new Date(date) : "",
      aht = d !== "" && d != null ? `${d.getHours()}:${d.getMinutes()}:${d.getSeconds()}` : "";

  return aht;
}

// function disableButtons(){
//     let assignBtn = document.querySelector('#assignSurvey'),
//         unassignBtn = document.querySelector('#unassignSurvey'),
//         needsInfoBtn = document.querySelector('#needsInfoBtn'),
//         consultBtn = document.querySelector('#consultBtn'),
//         caseIDInput = document.querySelector('#caseID');
    
    
//     caseIDInput.toggleAttribute("disabled");
//     assignBtn.classList.toggle("disabled");
//     unassignBtn.classList.toggle("disabled");
//     needsInfoBtn.classList.toggle("disabled");
//     consultBtn.classList.toggle("disabled");
//     clearInterval(refreshIntervalId);
// }

// function enableButtons(){
//     const compliantBtn = document.querySelector('#compliant-btn'),
//         closeBtn = document.querySelector('#close-btn'),
//         noncompliantBtn = document.querySelector('#noncompliant-btn'),
//         enable_actions = document.querySelector('#enable_actions'),
//         closeCase = document.querySelector('#closeCase');
    
//     // compliantBtn.classList.toggle('disabled');
//     // closeBtn.classList.toggle('disabled');
//     // noncompliantBtn.classList.toggle('disabled');
//     // // enable_actions.classList.toggle('disabled');
//     // closeCase.classList.toggle('disabled');
// }

/////////////////////////
/////////////////////////
/////////////////////////
////////////////////////


////////////////////////////////////
////////////////////////////////////
// Utilities and Helper Functions///
////////////////////////////////////
////////////////////////////////////

function gatherData() {
  console.log('Gathering data');
  // queueSelect.options[queueSelect.selectedIndex].value
  const reviewCategoriesInput = document.querySelector('#violations-chip'),
    reviewCategoriesChips = M.Chips.getInstance(reviewCategoriesInput),
    categoriesArray = reviewCategoriesChips.chipsData.map(e => e.tag);

  categoryString = encodeURIComponent(categoriesArray.join());

  // // old materialize chips method for getting material chips data
  // var data_chips= $('#violations-chip').material_chip('data'),
  //     categoryString = "";
  // for(var i = 0; i < dataChips.length; i++) {
  //     categoryString += `${dataChips[i].tag}, `;
  // }
  // let dataChipsTag = dataChips.map(e => e.tag);
  // categoryString = encodeURIComponent(dataChipsTag.join());

  //multiple-chip based selection
  // let targeting_data = $('#targeting-chips').material_chip('data'),
  //     targetingString = "";
  // targeting_data.forEach((chip) => {
  //     targetingString += chip.tag + ',';
  // });
  // targetingString = targetingString.replace(/,\s*$/, "");

  let queueSelect = document.querySelector('#queue-select'),
      countryInput = document.querySelector('#countryInput'),
      languageInput = document.querySelector('#languageInput'),
      rmto = document.querySelector('#rmto'),
      targetingCategories = document.querySelector('#targeting-categories'),
      screenshotText = document.querySelector('#screenshot-text'),
      numberOfQuestionsSelect = document.querySelector('#numberOfQuestions'),
      timesReviewedSelect = document.querySelector('#timesReviewed');
      
  const blsModeValue = JSON.parse(localStorage.settings).bls_mode;
      
      
  //old error handler
  // checkValidInput(languageInput.dataset.langcode, languageInput);
  
  //new error handler
  checkValidSelect(targetingCategories);
  checkValidSelect(languageInput);
  blsModeValue ? "" : checkValidSelect(countryInput);
  blsModeValue ? "" : checkValidSelect(numberOfQuestionsSelect);
  blsModeValue ? "" : checkValidSelect(timesReviewedSelect);
  
  let caseData = {
      queue: queueSelect.options[queueSelect.selectedIndex].value,
      violations: categoryString,
      country: countryInput.value,
      language: languageInput.dataset.langcode,
      RMTO: rmto.checked? "yes" : "no",
      surveyType: targetingCategories.value,
      numberOfQuestions: numberOfQuestionsSelect.options[numberOfQuestionsSelect.selectedIndex].value,
      timesReviewed: timesReviewedSelect.options[timesReviewedSelect.selectedIndex].value,
      screenshotText: screenshotText.value
  };



  console.log(caseData);
  return caseData;
}

function checkValidInput(inputData, inputElement){

  if (!inputElement.dataset.langcode) {
      
      console.log("invalid: " + inputElement.dataset.langcode);
      
      inputElement.setCustomValidity("This field is required");
      
      inputElement.classList.add("invalid", "invalid-placeholder");
      inputElement.setAttribute("placeholder", "This field is required.");
      closeCase.classList.add("disabled");
      
      
      inputElement.addEventListener('input', (e) => {
          if (!e.target.dataset.langcode){
              e.target.classList.remove("invalid", "invalid-placeholder");
              e.target.setAttribute("placeholder", "English");
              closeCase.classList.remove("disabled");
          } else {
              console.log(`${e.target}: ${e.target.value}: ${e.target.textContent}`)
          }
      });
  }
  
  console.log(inputElement.dataset.langcode);
  
  console.log(`${inputElement} is not empty`);
}

function checkValidSelect(selectElement){
  if (selectElement.value == ""){
      //add disable to finish
      closeCase.classList.add("disabled");
      
      //add error handler colors
      selectElement.parentElement.classList.add('invalid');
      
      // listen for input element change
      selectElement.addEventListener('change', (e) => {
          if (e.target.value !== ""){
              e.target.parentElement.classList.contains('invalid') ? e.target.parentElement.classList.remove('invalid') : "";
          } else {
              console.log(`${e.target} value changed to null!`)
          }
          
          const invalidInputs = Array.from(document.querySelectorAll('.invalid'));
          
          invalidInputs.length != 0 ? "" : closeCase.classList.remove("disabled");
          console.log({invalidInputs})
      });
  } else {
      console.log(`${selectElement} is valid!`)
  }
}


function checkValidURL() {
    let url = location.href;
    if (url.includes("https://redbull.corp.google.com")) {
        console.log('Allowed URL');
        init();
    } else if (url.includes("https://support.google.com/s/community")) {
        initPanels();
        
    } else {
        console.log("Forbidden URL");
    }
}

function set_aht(min, sec){
    nmin = min;
    nsec = sec;
    nhour = 0;
}
  
  

function getFormattedAHT(date){
  
  
  let d = date !== "" && date != null ? new Date(date) : "",
      aht = d !== "" && d != null ? `${d.getHours()}:${d.getMinutes()}:${d.getSeconds()}` : "";

  return aht;
}


function getSelectedQueue(){
  let selected = queueSelect.options[queueSelect.selectedIndex].value,
      categoryData = data.SRCategories;
  if (selected == "Survey Review") {
      categoryData = data.SRCategories;
  } else if(selected == "Support") {
      categoryData = data.supportCategories;
  } else if(selected == "Publisher") {
      categoryData = data.pubCategories;
  } else if(selected == "Publisher-New") {
      categoryData = data.pubCategories;
  } else if(selected == "Publisher-Support") {
      categoryData = data.pubCategories;
  } else if(selected == "Partnership"){
      categoryData = data.partnershipCategories;
  } else if(selected == "NonTransaction"){
      categoryData = data.nonTransactionCategories;
  } else {
      console.log('Invalid queue: ' + selected);
  }
  return categoryData;
}

function clearClass(){
    const customerTypeSelect = document.querySelector('#customer-type'),
    countryInput = document.querySelector('#countryInput'),
    languageInput = document.querySelector('#languageInput'),
    queueSelect = document.querySelector('#queue-select');

    queueSelect.parentElement.classList.remove('s12');
    customerTypeSelect.parentElement.classList.remove('hide');
    //surveyStatusSelect.parentElement.classList.remove('hide');
    languageInput.parentElement.classList.remove('hide');
    toggleDecisionBtn();
    
}

function returnCategories(array){
  let categories = [];
  array.forEach((category) => {
      categories.push(`<option value="${category.name}">${category.name}</option>`);
  });
  return categories;
}

function _doClearClass(e){
  if (e.className.includes("hide") != -1){
    e.classList.remove("hide");
  }
}



function checkDarkMode(){
    let settings = JSON.parse(localStorage.getItem('settings'));
    settings.dark_mode === true ? initDarkMode() : console.log("Dark Mode Deactivated");
}


function checkPosition(){
    let settings = JSON.parse(localStorage.getItem('settings'));
    settings.change_position === true ? initPosition() : console.log("Position Changed!");
}

function checkTemper(){
    let settings = JSON.parse(localStorage.getItem('settings'));
    settings.show_temper === true ? initTemper() : console.log("Temper toggled!");
}

function checkMV(){
    let settings = JSON.parse(localStorage.getItem('settings'));
    settings.show_MV === true ? initMV() : console.log("M/V toggled!");
}

function checkNI(){
    let settings = JSON.parse(localStorage.getItem('settings'));
    settings.show_NI === true ? initNI() : console.log("NI toggled!");
}

function checkCaseReminder(){
    let settings = JSON.parse(localStorage.getItem('settings'));
    settings.case_reminder === true ? initAlarm() : console.log("NI toggled!");
}

function checkConsultMonitoring(){
    let settings = JSON.parse(localStorage.getItem('settings'));
    settings.consult_monitoring === true ? initConsultMonitoring() : console.log("Consult Monitoring toggled!");
}

function checkNotifications(){
    const notificationsBtn = document.querySelector('#notifications-btn');
    const notificationsIcon = document.querySelector('#notifications-btn > i');
    let notifications = JSON.parse(localStorage.getItem('notifications'));
    
    let change = () => {
        notificationsIcon.textContent = `notifications`;
        notificationsIcon.classList.remove('red-icon');
    };
    
    let changeAgain = () => {
        notificationsIcon.textContent = `notifications_active`;
        notificationsIcon.classList.add('red-icon');
    }
    
    
    notifications.seen === true ? change() : changeAgain();
}


function clearCardValues(){
    dataChips = [];
    targetingChips = [];
    surveyReviewQueue();
    
    let queueSelect = document.querySelector('#queue-select'),
        violationsChip = document.querySelector('#violations-chip'),
        countryInput = document.querySelector('#countryInput'),
        languageInput = document.querySelector('#languageInput'),
        rmto = document.querySelector('#rmto'),
        numberOfQuestionsSelect = document.querySelector('#numberOfQuestions'),
        timesReviewedSelect = document.querySelector('#timesReviewed'),
      //   surveyStatusSelect = document.querySelector('#surveystatus-select'),
        screenshotText = document.querySelector('#screenshot-text'),
        targetingCategories = document.querySelector('#targeting-categories'),
        numberOfQuestions = document.querySelector('#numberOfQuestions'),
        timesReviewed = document.querySelector('#timesReviewed'),
        searchWrappers = Array.from(document.querySelectorAll('.inputWrapper')),
        invalidInputs = Array.from(document.querySelectorAll('.invalid'));
    
    invalidInputs.length != 0 ? invalidInputs.forEach(input => input.classList.remove('invalid')) : "";
    searchWrappers.forEach(r => r.remove());
    numberOfQuestions.selectedIndex = 0,
    timesReviewed.selectedIndex = 0,
    targetingCategories.selectedIndex = 0,
    queueSelect.selectedIndex = 5,
    countryInput.value = "",
    countryInput.dataset.langcode = "",
    languageInput.value = "",
    languageInput.dataset.langcode = "",
    rmto.checked = false,
    
  //   surveyStatusSelect.selectedIndex = 0,
    numberOfQuestionsSelect = 0,
    timesReviewedSelect = 0,
    
    $(".chips .chip").remove(),
    screenshotText.value = "";
}

function preFinish(){
    let assigned = JSON.parse(localStorage.getItem('assigned')),
        caseID = document.querySelector('#caseID'),
        caseIDArray = caseID.value.split(",").length,
        caseInteractions = caseIDArray != 1 || 0 ? caseIDArray : 1,
        endDate = checkNeedsInfo() ? assigned.end_time : getFormattedDate(),
        aht = Math.abs(new Date(endDate) - new Date(assigned.start_time)),
        min = Math.floor((aht/1000)/60),
        sec = Math.floor((aht/1000)%60),
        data = gatherData();

    assigned["number_of_interactions"] = caseInteractions;
    assigned["end_time"] = endDate;
    assigned["aht"] = "00:" + min + ':' + sec;

    assigned["queue"] = data.queue;
    assigned["violations"] = data.violations;
    assigned["country"] = data.country;
    assigned["language"] = data.language;
    assigned["surveyType"] = data.surveyType;
    assigned["RMTO"] = data.RMTO;
    assigned["surveyStatus"] = data.surveyStatus;
    assigned["screenshotText"] = data.screenshotText;
    assigned["numberOfQuestions"] = data.numberOfQuestions;
    assigned["timesReviewed"] = data.timesReviewed;
    
    localStorage.setItem("assigned", JSON.stringify(assigned));
    
    console.log(data.language);
}

function getParameters(){
  let assigned = JSON.parse(localStorage.getItem('assigned'));
  console.log("notString: " + typeof assigned.survey_ids);
  console.log("string: " + typeof assigned.survey_ids.toString());

  let reviewStatus = "reviewStatus=reviewed",
      referenceID = `referenceID=`,
      caseID = `caseID=${assigned.survey_ids.toString()}`,
      queueType = `queueType=${assigned.queue}`,
      customerType = `customerType=`,
      tool = `tool=${caseID.includes("-") ? "Cases 2.0" : "EWOQ"}`,
      language = `language=${assigned.language}`,
      country = `country=${assigned.country}`,
      RMTO = `RMTO=${assigned.RMTO}`,
      surveyType = `surveyType=${assigned.surveyType}`,
      screenshot = `screenshot=${assigned.screenshotText}`,
      surveyDecision = `surveyDecision=${assigned.queue == "Support" ? "" : assigned.decision}`,
      startTimeMNL = `startTimeMNL=${assigned.start_time}`,
      startTimePST = `startTimePST=`,
      endTimeMNL = `endTimeMNL=${assigned.end_time}`,
      categories = `categories=${assigned.violations}`,
      AHT = `AHT=${assigned.aht}`,
      numberOfQuestions = `numberOfQuestions=${assigned.numberOfQuestions}`,
      timesReviewed = `timesReviewed=${assigned.timesReviewed}`,
      numberOfInteractions = `numberOfInteractions=${assigned.number_of_interactions}`;
  
  return `${reviewStatus}&${referenceID}&${caseID}&${queueType}&${customerType}&${tool}&${language}&${country}&${RMTO}&${surveyType}&${screenshot}&${surveyDecision}&${startTimeMNL}&${startTimePST}&${endTimeMNL}&${categories}&${AHT}&${numberOfInteractions}&${numberOfQuestions}&${timesReviewed}`;
}

function checkBLSMode(){
    let settings = JSON.parse(localStorage.getItem('settings'));
    return settings.bls_mode === true ? initBLSMode() : console.log("BLS Mode Deactivated");
}

function checkNeedsInfo(){
    let assigned = JSON.parse(localStorage.getItem('assigned'));
    return assigned.needs_info === true ?  true : false;
}

function initDecisionButtons(){
    const compliantBtn = document.querySelector('#compliant-btn'),
      closeBtn = document.querySelector('#close-btn'),
      noncompliantBtn = document.querySelector('#noncompliant-btn'),
      enable_actions = document.querySelector('#enable_actions'),
      caseTemplateBtn = document.querySelector('#caseTemplateBtn'),
      closeCase = document.querySelector('#closeCase');
      
    _doClearClass(caseTemplateBtn);
    _doClearClass(compliantBtn);
    _doClearClass(closeBtn);
    _doClearClass(noncompliantBtn);
}
    
function disableButtons(){
    let assignBtn = document.querySelector('#assignSurvey'),
        unassignBtn = document.querySelector('#unassignSurvey'),
        needsInfoBtn = document.querySelector('#needsInfoBtn'),
        consultBtn = document.querySelector('#consultBtn'),
        caseIDInput = document.querySelector('#caseID');
    
    
    caseIDInput.toggleAttribute("disabled");
    assignBtn.classList.toggle("disabled");
    unassignBtn.classList.toggle("disabled");
    needsInfoBtn.classList.toggle("disabled");
    consultBtn.classList.toggle("disabled");
    clearInterval(refreshIntervalId);
}

function enableButtons(){
    const compliantBtn = document.querySelector('#compliant-btn'),
        closeBtn = document.querySelector('#close-btn'),
        noncompliantBtn = document.querySelector('#noncompliant-btn'),
        enable_actions = document.querySelector('#enable_actions'),
        closeCase = document.querySelector('#closeCase');
    
    compliantBtn.classList.toggle('disabled');
    closeBtn.classList.toggle('disabled');
    noncompliantBtn.classList.toggle('disabled');
    enable_actions.classList.toggle('disabled');
    closeCase.classList.toggle('disabled');
}

function getFormattedDate(dateGiven){
    let date = dateGiven == null || undefined  ? new Date(): new Date(dateGiven),
    formattedDate = (date.getMonth() + 1) + '/' + date.getDate() +  "/" + date.getFullYear();
    return formattedDate = formattedDate + " " + date.getHours() + ":" + date.getMinutes() + ":" + date.getSeconds();
}

function AHT() {
    document.querySelector('#aht').innerText = nhour + ":" + nmin + ":" + nsec;
    if (!isPaused) {
        nsec += 1;
        if (nsec == 60) {
            nsec = 00;
            nmin += 1;
        } else if (nmin == 60) {
            nmin = 00;
            nhour += 1;
        }
    }
}

</script>